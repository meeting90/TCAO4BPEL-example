<!-- Travel BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Thu Feb 05 16:51:33 CST 2015 -->
<bpel:process expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0" name="Travel" queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0" suppressJoinFailure="yes" targetNamespace="http://cs.nju.edu.cn/tcao4bpel/travel" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:common="http://xsd.webservices.cs.nju.edu.cn/xsd" xmlns:flight="http://flight.webservices.cs.nju.edu.cn" xmlns:hotel="http://hotel.webservices.cs.nju.edu.cn" xmlns:tns="http://cs.nju.edu.cn/tcao4bpel/travel" xmlns:user="http://user.webservices.cs.nju.edu.cn">
  <bpel:import importType="http://www.w3.org/2001/XMLSchema" location="common.xsd" namespace="http://xsd.webservices.cs.nju.edu.cn/xsd"/>
  <bpel:import importType="http://schemas.xmlsoap.org/wsdl/" location="UserService.wsdl" namespace="http://user.webservices.cs.nju.edu.cn"/>
  <bpel:import importType="http://schemas.xmlsoap.org/wsdl/" location="HotelService.wsdl" namespace="http://hotel.webservices.cs.nju.edu.cn"/>
  <bpel:import importType="http://schemas.xmlsoap.org/wsdl/" location="FlightService.wsdl" namespace="http://flight.webservices.cs.nju.edu.cn"/>
  <bpel:import importType="http://schemas.xmlsoap.org/wsdl/" location="TravelArtifacts.wsdl" namespace="http://cs.nju.edu.cn/tcao4bpel/travel"/>
  <bpel:partnerLinks>
    <bpel:partnerLink myRole="me" name="client" partnerLinkType="tns:Travel"/>
    <bpel:partnerLink name="user" partnerLinkType="tns:User" partnerRole="UserProvider"/>
    <bpel:partnerLink name="flight" partnerLinkType="tns:Flight" partnerRole="FlightProvider"/>
    <bpel:partnerLink name="hotel" partnerLinkType="tns:Hotel" partnerRole="HotelProvider"/>
  </bpel:partnerLinks>
  <bpel:variables>
    <bpel:variable messageType="tns:TravelRequestMessage" name="input"/>
    <bpel:variable messageType="tns:TravelResponseMessage" name="output"/>
    <bpel:variable messageType="user:loginRequest" name="userRequest"/>
    <bpel:variable messageType="user:loginResponse" name="userResponse"/>
    <bpel:variable messageType="flight:searchFlightRequest" name="searchFlightRequest"/>
    <bpel:variable messageType="flight:searchFlightResponse" name="searchFlightResponse"/>
    <bpel:variable messageType="flight:bookFlightRequest" name="bookFlightRequest"/>
    <bpel:variable messageType="flight:bookFlightResponse" name="bookFlightResponse"/>
    <bpel:variable messageType="hotel:searchHotelRequest" name="searchHotelRequest"/>
    <bpel:variable messageType="hotel:searchHotelResponse" name="searchHotelResponse"/>
    <bpel:variable messageType="hotel:selectHotelRequest" name="selectHotelRequest"/>
    <bpel:variable messageType="hotel:selectHotelResponse" name="selectHotelResponse"/>
    <bpel:variable messageType="hotel:reserveHotelRequest" name="reserveHotelRequest"/>
    <bpel:variable messageType="hotel:reserveHotelResponse" name="reserveHotelResponse"/>
    <bpel:variable messageType="flight:selectFlightRequest" name="selectFlightRequest"/>
    <bpel:variable messageType="flight:selectFlightResponse" name="selectFlightResponse"/>
  </bpel:variables>
  <bpel:sequence name="main">
    <bpel:receive createInstance="yes" name="receiveInput" operation="travelOrder" partnerLink="client" portType="tns:Travel" variable="input"/>
    <bpel:sequence name="retrieveCustomerInfoWrapper">
      <bpel:assign>
        <bpel:copy>
          <bpel:to part="parameters" variable="userRequest"/>
          <bpel:from>
            <bpel:literal xml:space="preserve">
              <ns:login xmlns:ns="http://user.webservices.cs.nju.edu.cn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <ns:username>ns:username</ns:username>
                <ns:password>ns:password</ns:password>
              </ns:login>
            </bpel:literal>
          </bpel:from>
        </bpel:copy>
        <bpel:copy>
          <bpel:from>$input.payload/tns:username</bpel:from>
          <bpel:to>$userRequest.parameters/user:username</bpel:to>
        </bpel:copy>
        <bpel:copy>
          <bpel:from>$input.payload/tns:password</bpel:from>
          <bpel:to>$userRequest.parameters/user:password</bpel:to>
        </bpel:copy>
      </bpel:assign>
      <bpel:invoke inputVariable="userRequest" name="retrieveCustomerInfo" operation="login" outputVariable="userResponse" partnerLink="user"/>
    </bpel:sequence>
    <bpel:flow name="concurrent">
      <bpel:sequence name="flight">
        <bpel:sequence name="searchFlightWrapper">
          <bpel:assign name="prepareSearchFlightInput">
            <bpel:copy>
              <bpel:from>
                <bpel:literal>
                  <ns:searchFlightResponse xmlns:ns="http://flight.webservices.cs.nju.edu.cn" xmlns:tns="http://xsd.webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:return>
                      <tns:children>
                        <tns:airline>tns:airline</tns:airline>
                        <tns:arrival>tns:arrival</tns:arrival>
                        <tns:arrivalAirport>tns:arrivalAirport</tns:arrivalAirport>
                        <tns:arrivalTime>2001-01-01</tns:arrivalTime>
                        <tns:deloyTime>0</tns:deloyTime>
                        <tns:departure>tns:departure</tns:departure>
                        <tns:departureAirport>tns:departureAirport</tns:departureAirport>
                        <tns:departureTime>2001-01-01</tns:departureTime>
                        <tns:flightId>tns:flightId</tns:flightId>
                        <tns:price>0.0</tns:price>
                        <tns:punctuality>0</tns:punctuality>
                      </tns:children>
                    </ns:return>
                  </ns:searchFlightResponse>
                </bpel:literal>
              </bpel:from>
              <bpel:to part="parameters" variable="searchFlightResponse"/>
            </bpel:copy>
            <bpel:copy>
              <bpel:to part="parameters" variable="searchFlightRequest"/>
              <bpel:from>
                <bpel:literal xml:space="preserve">
                  <ns:searchFlight xmlns:ns="http://flight.webservices.cs.nju.edu.cn" xmlns:tns="http://webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:departure>ns:departure</ns:departure>
                    <ns:arrival>ns:arrival</ns:arrival>
                    <ns:date>2001-12-31T12:00:00</ns:date>
                  </ns:searchFlight>
                </bpel:literal>
              </bpel:from>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:fromlocation
              </bpel:from>
              <bpel:to>$searchFlightRequest.parameters/flight:departure
              </bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:destination
              </bpel:from>
              <bpel:to>$searchFlightRequest.parameters/flight:arrival
              </bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:startDate</bpel:from>
              <bpel:to>$searchFlightRequest.parameters/flight:date</bpel:to>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke inputVariable="searchFlightRequest" name="searchFlight" operation="searchFlight" outputVariable="searchFlightResponse" partnerLink="flight"/>
        </bpel:sequence>
        <bpel:sequence>
          <bpel:assign name="prepareSelectFlightInput">
            <bpel:copy>
              <bpel:from>
                <bpel:literal xml:space="preserve">
                  <ns:selectFlight xmlns:ns="http://flight.webservices.cs.nju.edu.cn" xmlns:tns="http://xsd.webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:flights>
                      <tns:children>
                        <tns:airline>tns:airline</tns:airline>
                        <tns:arrival>tns:arrival</tns:arrival>
                        <tns:arrivalAirport>tns:arrivalAirport</tns:arrivalAirport>
                        <tns:arrivalTime>2001-01-01</tns:arrivalTime>
                        <tns:deloyTime>0</tns:deloyTime>
                        <tns:departure>tns:departure</tns:departure>
                        <tns:departureAirport>tns:departureAirport</tns:departureAirport>
                        <tns:departureTime>2001-01-01</tns:departureTime>
                        <tns:flightId>tns:flightId</tns:flightId>
                        <tns:price>0.0</tns:price>
                        <tns:punctuality>0</tns:punctuality>
                      </tns:children>
                    </ns:flights>
                  </ns:selectFlight>
                </bpel:literal>
              </bpel:from>
              <bpel:to part="parameters" variable="selectFlightRequest"/>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$searchFlightResponse.parameters/flight:return</bpel:from>
              <bpel:to>$selectFlightRequest.parameters/flight:flights</bpel:to>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke inputVariable="selectFlightRequest" name="selectFlight" operation="selectFlight" outputVariable="selectFlightResponse" partnerLink="flight"/>
        </bpel:sequence>
        <bpel:sequence name="bookFlightWrapper">
          <bpel:assign name="prepareBookFlightInput">
            <bpel:copy>
              <bpel:to part="parameters" variable="bookFlightRequest"/>
              <bpel:from>
                <bpel:literal xml:space="preserve">
                  <ns:bookFlight xmlns:ns="http://flight.webservices.cs.nju.edu.cn" xmlns:tns="http://webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:flight>
                      <tns:airline>tns:airline</tns:airline>
                      <tns:arrival>tns:arrival</tns:arrival>
                      <tns:arrivalAirport>tns:arrivalAirport</tns:arrivalAirport>
                      <tns:arrivalTime>2001-01-01</tns:arrivalTime>
                      <tns:deloyTime>0</tns:deloyTime>
                      <tns:departure>tns:departure</tns:departure>
                      <tns:departureAirPort>tns:departureAirPort</tns:departureAirPort>
                      <tns:departureTime>2001-01-01</tns:departureTime>
                      <tns:flightId>tns:flightId</tns:flightId>
                      <tns:price>0.0</tns:price>
                      <tns:punctuality>0</tns:punctuality>
                    </ns:flight>
                    <ns:username>ns:username</ns:username>
                    <ns:phoneNumber>ns:phoneNumber</ns:phoneNumber>
                  </ns:bookFlight>
                </bpel:literal>
              </bpel:from>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$selectFlightResponse.parameters/flight:return</bpel:from>
              <bpel:to>$bookFlightRequest.parameters/flight:flight</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:username</bpel:from>
              <bpel:to>$bookFlightRequest.parameters/flight:username</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:phoneNumber</bpel:from>
              <bpel:to>$bookFlightRequest.parameters/flight:phoneNumber</bpel:to>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke inputVariable="bookFlightRequest" name="bookFlight" operation="bookFlight" outputVariable="bookFlightResponse" partnerLink="flight"/>
        </bpel:sequence>
      </bpel:sequence>
      <bpel:sequence name="hotel">
        <bpel:sequence name="searchHotelWrapper">
          <bpel:assign name="prepareSearchHotelInput">
            <bpel:copy>
              <bpel:to part="parameters" variable="searchHotelRequest"/>
              <bpel:from>
                <bpel:literal xml:space="preserve">
                  <ns:searchHotel xmlns:ns="http://hotel.webservices.cs.nju.edu.cn" xmlns:tns="http://webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:city>ns:city</ns:city>
                    <ns:checkinDate>2001-01-01</ns:checkinDate>
                    <ns:checkoutDate>2001-01-01</ns:checkoutDate>
                  </ns:searchHotel>
                </bpel:literal>
              </bpel:from>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:destination</bpel:from>
              <bpel:to>$searchHotelRequest.parameters/hotel:city</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:startDate</bpel:from>
              <bpel:to>$searchHotelRequest.parameters/hotel:checkinDate</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:endDate</bpel:from>
              <bpel:to>$searchHotelRequest.parameters/hotel:checkoutDate</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>
                <bpel:literal xml:space="preserve">
                  <ns:searchHotelResponse xmlns:ns="http://hotel.webservices.cs.nju.edu.cn" xmlns:tns="http://xsd.webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:return>
                      <tns:children>
                        <tns:city>tns:city</tns:city>
                        <tns:position>tns:position</tns:position>
                        <tns:price>0.0</tns:price>
                      </tns:children>
                    </ns:return>
                  </ns:searchHotelResponse>
                </bpel:literal>
              </bpel:from>
              <bpel:to variable="searchHotelResponse" part="parameters"/>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke inputVariable="searchHotelRequest" name="searchHotel" operation="searchHotel" outputVariable="searchHotelResponse" partnerLink="hotel"/>
        </bpel:sequence>
        <bpel:sequence>
          <bpel:assign name="prepareSelectHotelInput">
            <bpel:copy>
              <bpel:from>
                <bpel:literal>
                  <ns:selectHotel xmlns:ns="http://hotel.webservices.cs.nju.edu.cn" xmlns:tns="http://xsd.webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:hotels>
                      <tns:children>
                        <tns:city>tns:city</tns:city>
                        <tns:position>tns:position</tns:position>
                        <tns:price>0.0</tns:price>
                      </tns:children>
                    </ns:hotels>
                  </ns:selectHotel>
                </bpel:literal>
              </bpel:from>
              <bpel:to part="parameters" variable="selectHotelRequest"/>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$searchHotelResponse.parameters/hotel:return</bpel:from>
              <bpel:to>$selectHotelRequest.parameters/hotel:hotels</bpel:to>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke inputVariable="selectHotelRequest" name="selectHotel" operation="selectHotel" outputVariable="selectHotelResponse" partnerLink="hotel"/>
        </bpel:sequence>
        <bpel:sequence name="reserveHotelWrapper">
          <bpel:assign name="prepareReserveHotelInput">
            <bpel:copy>
              <bpel:to part="parameters" variable="reserveHotelRequest"/>
              <bpel:from>
                <bpel:literal xml:space="preserve">
                  <ns:reserveHotel xmlns:ns="http://hotel.webservices.cs.nju.edu.cn" xmlns:tns="http://webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                    <ns:hotel>
                      <tns:city>tns:city</tns:city>
                      <tns:position>tns:position</tns:position>
                      <tns:price>0.0</tns:price>
                    </ns:hotel>
                    <ns:username>ns:username</ns:username>
                    <ns:phoneNumber>ns:phoneNumber</ns:phoneNumber>
                  </ns:reserveHotel>
                </bpel:literal>
              </bpel:from>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$selectHotelResponse.parameters/hotel:return</bpel:from>
              <bpel:to>$reserveHotelRequest.parameters/hotel:hotel</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:username</bpel:from>
              <bpel:to>$reserveHotelRequest.parameters/hotel:username</bpel:to>
            </bpel:copy>
            <bpel:copy>
              <bpel:from>$input.payload/tns:phoneNumber</bpel:from>
              <bpel:to>$reserveHotelRequest.parameters/hotel:phoneNumber</bpel:to>
            </bpel:copy>
          </bpel:assign>
          <bpel:invoke inputVariable="reserveHotelRequest" name="reserveHotel" operation="reserveHotel" outputVariable="reserveHotelResponse" partnerLink="hotel"/>
        </bpel:sequence>
      </bpel:sequence>
    </bpel:flow>
    <bpel:sequence name="replyWrapper">
      <bpel:assign name="prepareReply">
        <bpel:copy>
          <bpel:to part="payload" variable="output"/>
          <bpel:from>
            <bpel:literal xml:space="preserve">
              <tns:TravelResponse xmlns:tns="http://cs.nju.edu.cn/tcao4bpel/travel" xmlns:tns1="http://webservices.cs.nju.edu.cn/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <tns:success>true</tns:success>
                <tns:hotelInfo>
                  <tns1:city>tns1:city</tns1:city>
                  <tns1:position>tns1:position</tns1:position>
                  <tns1:price>0.0</tns1:price>
                </tns:hotelInfo>
                <tns:flightInfo>
                  <tns1:airline>tns1:airline</tns1:airline>
                  <tns1:arrival>tns1:arrival</tns1:arrival>
                  <tns1:arrivalAirport>tns1:arrivalAirport</tns1:arrivalAirport>
                  <tns1:arrivalTime>2001-01-01</tns1:arrivalTime>
                  <tns1:deloyTime>0</tns1:deloyTime>
                  <tns1:departure>tns1:departure</tns1:departure>
                  <tns1:departureAirPort>tns1:departureAirPort</tns1:departureAirPort>
                  <tns1:departureTime>2001-01-01</tns1:departureTime>
                  <tns1:flightId>tns1:flightId</tns1:flightId>
                  <tns1:price>0.0</tns1:price>
                  <tns1:punctuality>0</tns1:punctuality>
                </tns:flightInfo>
              </tns:TravelResponse>
            </bpel:literal>
          </bpel:from>
        </bpel:copy>
        <bpel:copy>
          <bpel:from>$bookFlightResponse.parameters/flight:return</bpel:from>
          <bpel:to>$output.payload/tns:success</bpel:to>
        </bpel:copy>
        <bpel:copy>
          <bpel:from>$selectFlightResponse.parameters/flight:return</bpel:from>
          <bpel:to>$output.payload/tns:flightInfo</bpel:to>
        </bpel:copy>
        <bpel:copy>
          <bpel:from>$selectHotelResponse.parameters/hotel:return</bpel:from>
          <bpel:to>$output.payload/tns:hotelInfo</bpel:to>
        </bpel:copy>
      </bpel:assign>
      <bpel:reply name="replyTravelOrder" operation="travelOrder" partnerLink="client" variable="output"/>
    </bpel:sequence>
  </bpel:sequence>
</bpel:process>